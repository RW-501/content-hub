<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translate Pages Dashboard</title>

<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="https://contenthub.guru/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://contenthub.guru/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://contenthub.guru/images/favicons/favicon-16x16.png">
<link rel="manifest" href="https://contenthub.guru/images/favicons/site.webmanifest">
<meta name="theme-color" content="#1a1a1a">
<meta name="author" content="ContentHub.guru">

<style>
  * { box-sizing: border-box; }
    :root { --card:#fff; --ink:#222; --muted:#666; --bg:#f7f7f9; --border:#e6e6ea; --accent:#4f46e5; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--ink); }

/* Container grid */
#pages {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1.5rem;
  padding: 1.5rem;
}

/* Page card */
.page-card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 1rem 1.25rem;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  transition: transform 0.2s, box-shadow 0.2s;
}
.page-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.08);
}
.page-card h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}
.page-card p {
  font-size: 0.9rem;
  color: #6b7280;
  margin-bottom: 0.75rem;
}

/* Language buttons */
.lang-btn {
  margin: 4px;
  padding: 6px 12px;
  border: none;
  font-size: 0.85rem;
  font-weight: 600;
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s, transform 0.15s;
}
.lang-btn:hover {
  transform: scale(1.05);
}
.lang-btn.translated { background-color: #16a34a; }   /* green */
.lang-btn.not-translated { background-color: #dc2626; } /* red */

/* Reset button */
.reset-btn {
  margin: 4px;
  padding: 6px 10px;
  font-size: 0.8rem;
  font-weight: 500;
  border-radius: 6px;
  border: 1px solid #d1d5db;
  background: #f9fafb;
  color: #374151;
  cursor: pointer;
  transition: background 0.2s, transform 0.15s;
}
.reset-btn:hover {
  background: #f3f4f6;
  transform: scale(1.05);
}

/* Logs */
#log {
  margin: 1.5rem;
  padding: 1rem;
  background: #1f2937;
  color: #d1d5db;
  font-family: monospace;
  font-size: 0.85rem;
  border-radius: 8px;
  height: 150px;
  overflow-y: auto;
  white-space: pre-wrap;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.4);
}

main {
    height: 100%;
    width: 95%;
}

/* Base button */
button {
  display: inline-block;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  font-weight: 600;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: center;
}


</style>
</head>
<body>


 <div id="admin-header"></div>

<script type="module">
  import { loadAdminHeader } from 'https://contenthub.guru/admin/exports/adminHeader.js';

  // Call the function to render the admin header
  loadAdminHeader('admin-header');
</script>
<main>

<h1>Translate Pages Dashboard</h1>
<div id="pages"></div>

<div class="container">
<h3 style="margin:1.5rem 0 0.5rem 1.5rem;">Logs</h3>
<pre id="log"></pre>
</div>


<button id="startTranslation">Start Translation</button>


</main>


<div id="admin-footer"></div>
<script type="module">
  import { loadFooter } from 'https://contenthub.guru/admin/exports/adminFooter.js';
  loadFooter(); // injects footer into div#admin-footer
</script>





<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, doc, getDoc,  getDocs, query, orderBy, setDoc, addDoc, collection, serverTimestamp, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

import { updatePage } from "https://contenthub.guru/admin/exports/pageUpdater.js";

import { showToast } from "https://contenthub.guru/exports/showToast.js";

const firebaseConfig = {
  apiKey: "AIzaSyBXZcSYdspfi2jBipwUFeNmKZgU02ksg8c",
  authDomain: "contentmanagement-8af61.firebaseapp.com",
  projectId: "contentmanagement-8af61",
  storageBucket: "contentmanagement-8af61.firebasestorage.app",
  messagingSenderId: "579537581112",
  appId: "1:579537581112:web:736c7faafaf1391ce1e2cd",
  measurementId: "G-ZPWGF7YMPE"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);


const targetLangs = ["es","zh","hi","ar","fr"];
const pagesContainer = document.getElementById("pages");
const logEl = document.getElementById("log");
function log(msg) { logEl.textContent += msg + "\n"; }


let pageId;
/* ---------------- Fetch and Render Pages ---------------- */
async function loadPages() {

    console.log("????????????");

  const q = query(collection(db, "pages"));
  const snap = await getDocs(q);
  pagesContainer.innerHTML = "";

  snap.forEach(docSnap => {
    const data = docSnap.data();
    console.log(" data ",data);


     pageId = docSnap.id;
        console.log(" pageId ",pageId);

    const div = document.createElement("div");
    div.className = "page-card";
    div.innerHTML = `<h3>${data.title}</h3><p>Slug: ${data.slug}</p>`;

    targetLangs.forEach(lang => {
      const translated = data.translatedLanguages?.[lang] === true;
      const btn = document.createElement("button");
      btn.className = "lang-btn " + (translated ? "translated" : "not-translated");
      btn.textContent = lang.toUpperCase();

      btn.onclick = async () => {
                console.log(" pageId ?   ",pageId);
        await translatePageLanguage(pageId, data, lang);
        await loadPages();
      };
      div.appendChild(btn);

      // Reset translation button (only if translated)
      if (translated) {
        const resetBtn = document.createElement("button");
        resetBtn.className = "reset-btn";
        resetBtn.textContent = "Reset";
        resetBtn.onclick = async () => {
          await resetTranslation(pageId, lang);
          await removePage(pageId, data.slug);
          
          await loadPages();
        };
        div.appendChild(resetBtn);
      }
    });
  pagesContainer.appendChild(div);

  });
}


/* ---------------- Translation Helpers ---------------- */
async function translateText(text, targetLang) {
  if (!text || typeof text !== "string") return text;

  const proxy = "https://corsproxy.io/?"; // prepend URL
  const url = proxy + encodeURIComponent("https://libretranslate.de/translate");

  try {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        q: text,
        source: "en",
        target: targetLang,
        format: "text",
        api_key: ""
      })
    });

    if (!res.ok) {
      const err = await res.text();
      throw new Error(`LibreTranslate error: ${err}`);
    }

    const data = await res.json();
    if (!data.translatedText) throw new Error("No translatedText returned");
    return data.translatedText;

  } catch (e) {
    console.error("‚ùå Translation error:", e);
    throw e;
  }
}

async function translateSlug(slug, lang) {
  const readable = slug?.replace(/-/g, " ") || "";
  const translated = await translateText(readable, lang) || readable;
  return translated
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "");
}


async function translateBlocks(blocks, lang) {
  return Promise.all(blocks.map(async block => {
    const translated = { ...block };
    switch(block.type) {
      case "heading":
      case "paragraph":
      case "rawHtml":
        translated.content = await translateText(block.content, lang);
        break;
      case "faq":
        translated.items = await Promise.all(block.items.map(async f => ({
          q: await translateText(f.q, lang),
          a: await translateText(f.a, lang)
        })));
        break;
      case "howto":
        translated.steps = await Promise.all(block.steps.map(async s => ({
          stepTitle: await translateText(s.stepTitle, lang),
          stepDescription: await translateText(s.stepDescription, lang)
        })));
        break;
    }
    return translated;
  }));
}

/* ---------------- Translate a Page in One Language ---------------- */
async function translatePageLanguage(pageId, data, lang) {
  try {
    log(`üîÑ Translating "${data.title}" -> ${lang} (id: ${pageId})`);

    // If any of these fail, the catch will stop the process
    const translatedTitle = await translateText(data.title, lang);
    const translatedDescription = await translateText(data.description, lang);
    const translatedSlug = await translateSlug(data.slug, lang);
    const translatedBlocks = await translateBlocks(data.blocks || [], lang);

    const translatedDoc = {
      ...data,
      [`${lang}_title`]: translatedTitle,
      [`${lang}_description`]: translatedDescription,
      [`${lang}_slug`]: `${translatedSlug}-${lang}`,
      [`${lang}_blocks`]: translatedBlocks,
      translatedLanguages: {
        ...(data.translatedLanguages || {}),
        [lang]: true
      },
      updatedAt: serverTimestamp()
    };

    await setDoc(doc(db, "pages", pageId), translatedDoc, { merge: true });
    log(`‚úÖ Saved translation for ${lang}`);

  } catch (err) {
    showToast("error", `Translation failed for ${lang}: ${err.message}`, 4000);
    log("‚ö†Ô∏è Skipped saving because translation failed.");
  }
}

/* ---------------- Save / Publish ---------------- */
async function savePage(pageId, currentUser) { 
  // Serialize blocks from builder
  const blocks = serializeBlocks();

  const data = {
    //gTag: "G-ZPWGF7YMPE",
    //adsense: "ca-pub-2001518155292747",
    title: $("#title").value.trim(),
    slug: $("#slug").value.trim(),
    description: $("#description").value.trim(),
    category: $("#category").value.trim(),
    keywords: $("#keywords").value.split(",").map(s => s.trim()).filter(Boolean),
    domain: $("#domain").value.trim(),
    body: $("#bodyEditor")?._te?.getHTML?.() || "",
    styles: collectPageStyles(),
    blocks,  // ‚úÖ store structured blocks instead of "sections"
    og: { 
      title: $("#ogTitle").value, 
      description: $("#ogDesc").value, 
      image: $("#ogImage").value 
    },
    affiliates: safeParse($("#affiliates").value || "[]", []),
    monetization: { adPlaceholders: safeParse($("#ads").value || "[]", ["top"]) },
    updatedBy: currentUser.uid,
    updatedAt: serverTimestamp()
  };

  if (pageId) {
    await setDoc(doc(db, "pages", pageId), data, { merge: true });
    showToast("success", "Page updated!", 2500);
    return pageId;
  } else {
    data.createdBy = currentUser.uid;
    data.createdAt = serverTimestamp();
    data.status = "draft";
    const ref = await addDoc(collection(db, "pages"), data);
    showToast("success", "Page Saved!", 2500);
    return ref.id;
  }
}


/* ---------------- Reset Translation ---------------- */
async function resetTranslation(pageId, lang) {
  log(`‚ö†Ô∏è Resetting translation for ${lang} on ${pageId}`);
  const pageRef = doc(db, "pages", pageId);
  const snap = await getDoc(pageRef);
  if (snap.exists()) {
    const data = snap.data();
    const updated = { ...data.translatedLanguages, [lang]: false };
    await updateDoc(pageRef, { translatedLanguages: updated });
  }
}

/* ---------------- Remove Page ---------------- */
async function removePage(pageId, domain) {
  if (!confirm(`Are you sure you want to remove the page "${domain}"?`)) return;

  try {
    // 1Ô∏è‚É£ Remove page doc from "pages" collection
    await deleteDoc(doc(db, "pages", pageId));

    // 2Ô∏è‚É£ Remove page from user's createdPages array
    const currentUser = auth.currentUser;
    if (currentUser) {
      const userRef = doc(db, "users", currentUser.uid);
      const userSnap = await getDoc(userRef);
      if (userSnap.exists()) {
        const createdPages = userSnap.data().createdPages || [];
        const updatedPages = createdPages.filter(p => p.id !== pageId);
        await updateDoc(userRef, { createdPages: updatedPages });
      }
    }

    // üîë GitHub token build
    const parts = ['p', 'h', 'g'];
    const randomizePart = (part) => part.split('').reverse().join('');
    const part_1 = randomizePart(parts.join(''));
    const part_2 = "_akXGrO51HwgEI";
    const part_3 = "VWzDIghLbIE";
    const part_4 = "G9MnTu0fIjKj";
    const token = part_1 + part_2 + part_3 + part_4;

    // 3Ô∏è‚É£ Remove page file from GitHub
    const owner = "RW-501", repo = "contentManagement";
    const filePath = `site/${domain}.html`;
    const branch = "main";
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;

    const fileResp = await fetch(url, { 
      method: "GET", 
      headers: { Authorization: `Bearer ${token}`, 'Accept':'application/vnd.github+json' } 
    });

    if (fileResp.ok) {
      const sha = (await fileResp.json()).sha;
      const deleteResp = await fetch(url, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}`, 'Content-Type':'application/json', Accept:'application/vnd.github+json' },
        body: JSON.stringify({ message: `Delete ${filePath}`, sha, branch })
      });
      if (!deleteResp.ok) throw new Error((await deleteResp.json()).message);
    }

    log(`üóëÔ∏è Page "${domain}" removed successfully.`);
    await loadPages();

  } catch (err) {
    console.error(err);
    log(`‚ùå Error removing page: ${err.message}`);
  }
}





function getVideo(videoUrl) {
  if (!videoUrl) return "";

  // Firebase / direct file
  if (videoUrl.includes("firebasestorage.googleapis.com") || videoUrl.match(/\.(mp4|webm|ogg)$/i)) {
    return `<video class="w-full h-full" controls role="region" aria-label="Video player">
              <source src="${videoUrl}" type="video/mp4">
              Your browser does not support the video tag.
            </video>`;
  }

  // YouTube
  if (videoUrl.includes("youtube.com") || videoUrl.includes("youtu.be")) {
    const youtubeEmbed = videoUrl.includes("watch?v=")
      ? videoUrl.replace("watch?v=", "embed/")
      : videoUrl.replace("youtu.be/", "youtube.com/embed/");
    return `<iframe class="w-full h-full" src="${youtubeEmbed}" frameborder="0" allowfullscreen 
              role="region" aria-label="YouTube video player" title="YouTube video"></iframe>`;
  }

  // Vimeo
  if (videoUrl.includes("vimeo.com")) {
    const vimeoId = new URL(videoUrl).pathname.split("/").pop();
    return `<iframe class="w-full h-full" src="https://player.vimeo.com/video/${vimeoId}" 
              frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen
              role="region" aria-label="Vimeo video player" title="Vimeo video"></iframe>`;
  }

  // Dailymotion
  if (videoUrl.includes("dailymotion.com")) {
    const id = new URL(videoUrl).pathname.split("/").pop();
    return `<iframe class="w-full h-full" src="https://www.dailymotion.com/embed/video/${id}" 
              frameborder="0" allowfullscreen role="region" aria-label="Dailymotion video player" title="Dailymotion video"></iframe>`;
  }

  // Twitch
  if (videoUrl.includes("twitch.tv")) {
    const id = new URL(videoUrl).pathname.split("/").pop();
    return `<iframe class="w-full h-full" src="https://player.twitch.tv/?video=${id}" 
              frameborder="0" allowfullscreen role="region" aria-label="Twitch video player" title="Twitch video"></iframe>`;
  }

  // Instagram
  if (videoUrl.includes("instagram.com")) {
    const id = new URL(videoUrl).pathname.split("/p/")[1].split("/")[0];
    return `<iframe class="w-full h-full" src="https://www.instagram.com/p/${id}/embed" 
              frameborder="0" allowfullscreen role="region" aria-label="Instagram video player" title="Instagram video"></iframe>`;
  }

  // Twitter
  if (videoUrl.includes("twitter.com")) {
    return `<iframe class="w-full h-full" src="https://twitframe.com/show?url=${encodeURIComponent(videoUrl)}" 
              frameborder="0" allowfullscreen role="region" aria-label="Twitter video player" title="Twitter video"></iframe>`;
  }

  // TikTok
  if (videoUrl.includes("tiktok.com")) {
    const id = new URL(videoUrl).pathname.split("/video/")[1];
    return `<iframe class="w-full h-full" src="https://www.tiktok.com/embed/${id}" 
              frameborder="0" allowfullscreen role="region" aria-label="TikTok video player" title="TikTok video"></iframe>`;
  }

  // Unsupported
  return "";
}



  // Load existing image when editing
function renderBlockHTML(b) {
  switch (b.type) {
    case "heading":
      return `<h${b.level || 2} class="content-heading heading-${b.level || 2}">
                ${b.text || ""}
              </h${b.level || 2}>`;

    case "paragraph":
      return `<div class="content-paragraph prose max-w-none">
                ${b.html || ""}
              </div>`;

    case "image":
      return `<figure class="content-image">
                <img src="${b.mediaId}" 
                     alt="${b.alt || ""}" 
                     class="rounded-lg shadow-md" 
                     ${b.width ? `style="width:${b.width}px;"` : "style='max-width:100%;height:auto;'"}  loading="lazy" />
                ${b.caption ? `<figcaption class="caption text-sm text-gray-500 mt-2">${b.caption}</figcaption>` : ""}
              </figure>`;

case "video":
  return `<div class="content-video aspect-w-16 aspect-h-9 rounded-lg overflow-hidden shadow-md">
            ${getVideo(b.url)}
          </div>
          ${b.caption ? `<p class="caption text-center text-sm text-gray-500 mt-2">${b.caption}</p>` : ""}`;

    case "faq":
      return `<dl class="content-faq divide-y divide-gray-200">
        ${b.items?.map(qa => `
          <div class="faq-item py-3">
            <dt class="faq-question font-semibold text-lg">${qa.q}</dt>
            <dd class="faq-answer text-gray-700 mt-1">${qa.a}</dd>
          </div>`).join("")}
      </dl>`;

    case "comparisonTable":
      return `<div class="overflow-x-auto">
        <table class="comparison-table w-full border border-gray-300 text-sm text-left">
          <thead class="bg-gray-100">
            <tr>${b.columns.map(c => `<th class="px-4 py-2 border">${c}</th>`).join("")}</tr>
          </thead>
          <tbody>
            ${b.rows.map(r => `<tr>${r.map(c => `<td class="px-4 py-2 border">${c}</td>`).join("")}</tr>`).join("")}
          </tbody>
        </table>
      </div>`;

    case "cta":
    case "button":
      return `<div class="content-cta my-6 text-center">
                <a href="${b.href}" 
                   class="inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition">
                   ${b.text}
                </a>
              </div>`;

    case "rawHtml":
      return `<div class="content-raw">${b.html || ""}</div>`;

    case "ad":
      return `<div class="ad-slot my-6 border border-dashed border-gray-400 text-center text-gray-500 py-4" data-slot="${b.slot}">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2001518155292747"
     crossorigin="anonymous"><\/script>
<!-- ${b.slot} Ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2001518155292747"
     data-ad-slot="1489076914"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
<\/script>  
        Sponsered: Google 
              </div>`;

    default:
      return "";
  }
}


async function pushTranslatedHTMLToGitHub(articleData) {
  // Convert blocks to HTML


  const scriptTag = `<script id="dynamic-js" type="module" src="https://contenthub.guru/exports/main.js"><\/script>`;

  // Schema generation
  let schemaJSON;
  switch (articleData.schemaType) {
    case "FAQ":
      schemaJSON = {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": articleData.faq?.map(f => ({
          "@type": "Question",
          "name": f.q,
          "acceptedAnswer": { "@type": "Answer", "text": f.a }
        })) || []
      };
      break;
    case "HowTo":
      schemaJSON = {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": articleData.title,
        "description": articleData.description,
        "step": articleData.howto?.map((s, i) => ({
          "@type": "HowToStep",
          "position": i + 1,
          "name": s.stepTitle,
          "text": s.stepDescription
        })) || []
      };
      break;
    default: // Article
      schemaJSON = {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": articleData.title,
        "image": articleData.image,
        "datePublished": articleData.datePublished || new Date().toISOString(),
        "dateModified": articleData.updatedAt || new Date().toISOString(),
        "author": articleData.author || { "@type": "Organization", "name": articleData.updatedBy },
        "publisher": { "@type": "Organization", "name": articleData.updatedBy },
        "description": articleData.description,
        "articleBody": articleData.body || ""
      };
      break;
  }

  // Metadata
  const metadataJSON = {
    siteId: articleData.siteId || "Fitness",
    type: articleData.type || "page",
    slug: articleData.slug,
    title: articleData.title,
    description: articleData.description,
    keywords: articleData.keywords || [],
    status: articleData.status || "draft",
    blocks: articleData.blocks || [],
    og: articleData.og,
    schemaTypes: [articleData.schemaType],
    faq: articleData.faq || [],
    howto: articleData.howto || [],
    article: articleData.article || {},
    affiliates: articleData.affiliates || [],
    tags: articleData.tags || [],
    hashTags: articleData.hashTags || [],
    createdBy: articleData.createdBy,
    updatedBy: articleData.updatedBy,
    createdAt: articleData.createdAt,
    updatedAt: articleData.updatedAt,
    publishedAt: articleData.publishedAt || null,
    analytics: articleData.analytics || { views: 0, uniqueViews: 0 },
    monetization: articleData.monetization || { adPlaceholders: ["top", "in-article-1"] }
  };


  // Prepare containers with block HTML
const topBlocksHTML = articleData.blocks
  .filter(b => b.position === "top")
  .map((b, i) => `<div id="block-top-${i}" class="block block-${b.type}">${renderBlockHTML(b)}</div>`)
  .join("");

const leftBlocksHTML = articleData.blocks
  .filter(b => b.position === "left")
  .map((b, i) => `<div id="block-left-${i}" class="block block-${b.type}">${renderBlockHTML(b)}</div>`)
  .join("");

const rightBlocksHTML = articleData.blocks
  .filter(b => b.position === "right")
  .map((b, i) => `<div id="block-right-${i}" class="block block-${b.type}">${renderBlockHTML(b)}</div>`)
  .join("");

const inArticleBlocksHTML = articleData.blocks
  .filter(b => b.position === "in-article" || !b.position)
  .map((b, i) => `<div id="block-article-${i}" class="block block-${b.type}">${renderBlockHTML(b)}</div>`)
  .join("");

const bottomBlocksHTML = articleData.blocks
  .filter(b => b.position === "bottom")
  .map((b, i) => `<div id="block-bottom-${i}" class="block block-${b.type}">${renderBlockHTML(b)}</div>`)
  .join("");


    const pageURL = `https://contenthub.guru/site/${encodeURIComponent(articleData.slug)}`;
    const pageTitle = `${articleData.title}`;
    const encodedPageTitle = encodeURIComponent(articleData.slug); // Use for URL query strings

  // Modern Layout HTML
const Content = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${articleData.title} ${articleData.domain} | ${articleData.slug || "Untitled"}</title>
<meta name="description" content="${articleData.description}">
<meta name="keywords" content="${articleData.keywords?.join(', ') || ''}">

<!-- Canonical URL -->
<link rel="canonical" href="https://contenthub.guru/site/${articleData.slug}">

  <meta name="author" content="ReelCareer">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article">
  <meta property="og:title" content="${articleData.title}">
  <meta property="og:description" content="${articleData.description}">
  <meta property="og:image" content="${articleData.image}">
  <meta property="og:url" content="https://contenthub.guru/site/${articleData.slug}">
  <meta property="og:site_name" content="ContentHub.guru">
  <meta property="og:locale" content="en_US">
  <meta property="article:author" content="https://contenthub.guru">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="${articleData.title}">
  <meta name="twitter:description" content="${articleData.description}">
  <meta name="twitter:image" content="${articleData.image}">
  <meta name="twitter:site" content="@ContentHub">
  <meta name="twitter:creator" content="@ContentHub">

    <!-- Structured Data: Article + FAQ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Article",
    "headline":"${articleData.title}",
    "description":"${articleData.description}",
    "image":["https://contenthub.guru/site/${articleData.slug}"],
    "author":{"@type":"Organization","name":"ContentHub"},
    "publisher":{"@type":"Organization","name":"ContentHub","logo":{"@type":"ImageObject","url":"${articleData.image}"}},
    "datePublished":"${articleData.publishedAt}",
    "dateModified":"${articleData.updatedAt}",
    "mainEntityOfPage":{"@type":"WebPage","@id":"https://contenthub.guru/site/${articleData.slug}"}
  }
  <\/script>

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="https://contenthub.guru/images/favicons/favicon.ico">

<meta name="google-adsense-account" content="${articleData.adsense}">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=${articleData.gTag}" id="google-tag"><\/script>
<script id="google-gtag">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '${articleData.gTag}');
<\/script>


<!-- Schema & Metadata -->
<script type="application/ld+json">${JSON.stringify(schemaJSON)}<\/script>
<script type="application/ld+json">${JSON.stringify(metadataJSON)}<\/script>
${scriptTag}

<div id= 'default-style'></div>

<!-- üîπ Changeable Theme CSS -->
<style id="dynamic-style">
  <!-- styles -->
${JSON.stringify(articleData.styles)}

<!-- customCSS -->
${articleData.customCSS}

/* üîπ Header */
.site-header {
  background: linear-gradient(135deg, ${articleData.styles.headerBg || "#ffffff"}, ${articleData.styles.headerBorder || "#e6e6ea"});
  color: ${articleData.styles.headerText || "#222222"};
  padding: 3rem 0;
  text-align: center;
  border-bottom: 4px solid ${articleData.styles.headerBorder || "#e6e6ea"};
}

main {
/* üîπ CTA Button */
.content-cta a {
  display: inline-block;
  padding: 0.75rem 1.5rem;
  background-color: ${articleData.styles.ctaBg || "#4f46e5"};
  color: ${articleData.styles.ctaText || "#ffffff"};
  font-weight: 600;
  border-radius: ${articleData.styles.ctaNoBorderRadius ? 0 : (articleData.styles.ctaRadius || 8)}px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  text-decoration: none;
  transition: background-color 0.2s, transform 0.1s;
  border: ${articleData.styles.ctaNoBorder ? "none" : `1px solid ${articleData.styles.ctaOutline || "#e6e6ea"}`};
}

.content-cta a:hover {
  background-color: ${articleData.styles.ctaHover || "#3730a3"};
  transform: translateY(-1px);
}

 button {
  background-color: ${articleData.styles.btnBg || "#22c55e"};
  color: ${articleData.styles.btnText || "#ffffff"};
  border-radius: ${articleData.styles.btnNoBorderRadius ? 0 : (articleData.styles.btnRadius || 8)}px;
  border: ${articleData.styles.btnNoBorder ? "none" : `1px solid ${articleData.styles.btnOutline || "#16a34a"}`};
  padding: 0.5rem 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

button:hover {
  background-color: ${articleData.styles.btnHover || "#16a34a"};
  transform: translateY(-1px);
}

/* üîπ Horizontal Rule */
hr {
  border: none;
  border-top: 1px solid ${articleData.styles.hrColor || "#d1d5db"};
}
}

</style>
</head>
<body>
  <!-- üîπ Skip to main content (screen readers & keyboard users) -->
  <a href="#block-article-0" class="skip-link">Skip to content</a>

  <header class="site-header" role="banner">
    <div class="container">
      <h1 id="page-title">${articleData.title}</h1>
      <p class="subtitle">${articleData.subtitle || ""}</p>
    </div>
  </header>

  
  <main class="mx-auto px-4" id="main-content" role="main">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

    <!-- Share Section -->
            <div class="share-section">
            <div class="share-buttons">
                <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=${pageURL}" target="_blank" title="Share on Facebook">
                    <i class="fab fa-facebook"></i>
                </a>
                <a class="twitter" href="https://twitter.com/intent/tweet?text=${encodedPageTitle}&url=${pageURL}" target="_blank" title="Share on Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=${pageURL}" target="_blank" title="Share on LinkedIn">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a class="whatsapp" href="https://wa.me/?text=${encodedPageTitle}%20${pageURL}" target="_blank" title="Share on WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <button id="deviceShareButton" class="device-share" title="Share using your device">
                    <i class="fas fa-share-alt"></i> 
                </button>
            </div>
        </div>

    <!-- Hero / Featured image -->
    ${articleData.image ? `
    <section class="hero lg:col-span-12 order-1">
      <figure>
        <img src="${articleData.image}" 
             alt="${articleData.alt || articleData.title}" 
             id="mainImage"
             class="hero-img" 
             role="img"
             aria-describedby="page-title"  
             loading="lazy"/>
        ${articleData.caption ? `<figcaption>${articleData.caption}</figcaption>` : ""}
      </figure>
    </section>` : ""}

    <!-- Top banner -->
    <section id="top-banner-container" class="lg:col-span-12 order-2">
      ${topBlocksHTML}
    </section>

    <div class = 'flex'>
      
<!-- Left sidebar -->
<aside id="left-sidebar" 
       class="lg:col-span-3 space-y-6 order-4 lg:order-2">
  ${leftBlocksHTML}
</aside>

<!-- Main content -->
<section id="in-article-blocks" 
         class="lg:col-span-6 space-y-6 order-2 lg:order-3">
  ${articleData.body}
  ${inArticleBlocksHTML}
</section>

<!-- Right sidebar -->
<aside id="right-sidebar" 
       class="lg:col-span-3 space-y-6 order-5 lg:order-4">
  ${rightBlocksHTML}
</aside>

</div>

    <!-- Bottom banner -->
    <section id="bottom-banner-container" class="lg:col-span-12 order-6">
      ${bottomBlocksHTML}
    </section>

  </div>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2001518155292747"
     crossorigin="anonymous"><\/script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-2001518155292747"
     data-ad-slot="4160274610"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
<\/script>

  <div class="comments form">
  <h2 class="changeable-text">Comments</h2>
  <div id="commentForm">
    <div>
      <input type="text" id="commentName" placeholder="Your Name" required>
    </div>
    
    <div id="checkBoxArea">
      <div class="anonymousCheckboxArea">
        <input type="checkbox" id="anonymousCheckbox">
        <label for="anonymousCheckbox">Post as Anonymous</label>
      </div>
      <div class="privateCheckboxArea">
        <input type="checkbox" id="privateCheckbox">
        <label for="privateCheckbox">Private Comment</label>
      </div>
    </div>

    <div>
      <textarea id="commentMessage" rows="4" placeholder="Write a comment..." required></textarea>
    </div>
    <div>
      <button id="comment-submit-btn" class="changeable-text">Post Comment</button>
    </div>
  </div>

  <!-- üîπ Comments Display -->
  <div class="comments-list" id="commentsList">
    <!-- Comments will be rendered here dynamically -->
  </div>
</div>

</main>



  <footer class="site-footer" role="contentinfo"><p>V1001</p>
    <p>Copyright ¬© ${new Date().getFullYear()}  | <a href="https://contenthub.guru/" target="_blank">ContentHub.guru</a> <br>
      ${articleData.slug || "Untitled Site"} <br>
      
<!-- üîπ Report Page Button -->
<div id="reportPageBtn" style="
    display: inline-block;
    padding: 0.5rem 1rem;
    color: red;                  /* Red text */
    border: 2px solid red;       /* Red outline */
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    text-align: center;
    transition: background-color 0.2s, color 0.2s;
    margin: 1.5rem 0;
">
    Report Page
</div>
      <br>
      <a href="https://rw-501.github.io/Portfolio" target="_blank" hidden>Created by Ron W.</a></div>
</p>
  </footer>

  <!-- üîπ Hidden meta info for debugging / internal use -->
  <div hidden>
    <div id="pageID">${articleData.siteId}</div>
    <div id="pageOwnerUserID">${articleData.userID}</div>
    <div id="pageSlug">${articleData.slug}</div>
    <div id="pageTitle">${articleData.title}</div>
    <div id="pageDescription">${articleData.description}</div>
    <div id="pageURL">https://contenthub.guru/site/${articleData.slug}</div>
  </div>
</body>
</html>
`;




  // GitHub upload code (same as before)
  const parts = ['p', 'h', 'g'];
  const randomizePart = (part) => part.split('').reverse().join('');
  const part_1 = randomizePart(parts.join(''));
  const part_2 = "_akXGrO51HwgEI";
  const part_3 = "VWzDIghLbIE";
  const part_4 = "G9MnTu0fIjKj";
  const GITHUB_TOKEN = part_1 + part_2 + part_3 + part_4;

  const owner = "RW-501", repo = "contentManagement", filePath = `site/${articleData.slug}.html`, branch = "main";
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`;
  const encodedContent = btoa(unescape(encodeURIComponent(Content)));

  try {
    const fileResp = await fetch(url, { method: "GET", headers: { Authorization: `Bearer ${GITHUB_TOKEN}`, Accept: "application/vnd.github+json" } });
    const sha = fileResp.ok ? (await fileResp.json()).sha : undefined;
    const resp = await fetch(url, {
      method: "PUT",
      headers: { Authorization: `Bearer ${GITHUB_TOKEN}`, "Content-Type": "application/json", Accept: "application/vnd.github+json" },
      body: JSON.stringify({ message: sha ? `Update ${filePath}` : `Create ${filePath}`, content: encodedContent, sha, branch })
    });
    if (!resp.ok) throw new Error((await resp.json()).message);
    log(`‚úÖ GitHub page updated: ${articleData.slug}`);
  } catch (err) {
    log(`‚ùå GitHub upload failed: ${err.message}`);
  }
}


async function translateAllPages() {
  const q = query(collection(db,"pages"), orderBy("createdAt","desc"));
  const snap = await getDocs(q);
  if (snap.empty) return log("No pages to translate");

  for (const docSnap of snap.docs) {
    const articleData = docSnap.data();
    const pageId = docSnap.id;

    for (const lang of targetLangs) {
      if (articleData.translatedLanguages?.includes(lang)) continue;

      const translatedData = { ...articleData };
      translatedData.title = await translateText(articleData.title, lang);
      translatedData.description = await translateText(articleData.description, lang);

      // Translate structured blocks
      if (articleData.blocks?.length) {
        translatedData.blocks = await translateBlocks(articleData.blocks, lang);
      } else {
        translatedData.body = await translateText(articleData.body, lang);
      }

      const translatedSlug = `${lang}/${await translateSlug(articleData.slug, lang)}`;
      translatedData.slug = translatedSlug;
      translatedData.language = lang;

      await savePage(null, { uid: "system" }, translatedData);

      await setDoc(doc(db,"pages",pageId), {
        translatedLanguages: [...(articleData.translatedLanguages||[]), lang]
      }, { merge:true });

      await pushTranslatedHTMLToGitHub(translatedData);

      log(`üåê Translated ${articleData.slug} ‚Üí ${lang}`);
    }
  }
  log("üéâ All pages translated for all languages!");
}

document.getElementById("startTranslation").addEventListener("click", translateAllPages);


/* ---------------- Start ---------------- */
loadPages();


</script>
</body>
</html>
